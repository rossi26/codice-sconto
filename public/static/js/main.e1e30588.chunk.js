(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{31:function(e,t,a){e.exports=a(65)},36:function(e,t,a){},37:function(e,t,a){},55:function(e,t,a){},56:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(28),l=a.n(c),r=(a(36),a(9)),i=a(10),s=a(12),m=a(11),u=a(7),d=a(6),p=(a(37),a(13)),f=a.n(p),E=o.a.createContext({token:null,commId:null,login:function(){},logout:function(){}}),g=function(e){Object(s.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={isLogin:!0},n.switchModeHandler=function(){n.setState((function(e){return{isLogin:!e.isLogin}}))},n.submitHandler=function(e){e.preventDefault();var t=n.emailEl.current.value,a=n.passwordEl.current.value;if(0!==t.trim().length&&0!==a.trim().length){var o={query:'\n          query{\n            login(email:"'.concat(t,'",password:"').concat(a,'"){\n              commId\n              token\n              tokenExpiration\n            }\n          }')};if(!n.state.isLogin){var c=n.titleEl.current.value;o={query:'\n            mutation{\n                createComm(commInput:{ title:"'.concat(c,'" , email:"').concat(t,'" , password:"').concat(a,'" }){\n                    _id\n                    email\n                }\n            }\n            ')}}f.a.post("/graphql",o,{headers:{"Content-Type":"application/json"}}).then((function(e){e.data.data.login.token&&n.context.login(e.data.data.login.token,e.data.data.login.commId,e.data.data.login.tokenExpiration)})).catch((function(e){console.log(e,e.response)}))}},n.emailEl=o.a.createRef(),n.passwordEl=o.a.createRef(),n.titleEl=o.a.createRef(),n}return Object(i.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{type:"email",className:"form-control",id:"email",ref:this.emailEl,placeholder:"Email"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{type:"password",className:"form-control",id:"password",ref:this.passwordEl,placeholder:"Password"})),this.state.isLogin?null:o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{type:"text",className:"form-control",id:"nome",ref:this.titleEl,placeholder:"Nome"}))),o.a.createElement("div",{className:"form-actions"},o.a.createElement("button",{className:"btn btn-primary",type:"submit"},"Submit"),o.a.createElement("button",{className:"btn btn-primary",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"Signup":"Login"))),o.a.createElement("section",null,o.a.createElement("div",null)))}}]),a}(n.Component);g.contextType=E;var h=g,v=(a(55),function(e){return o.a.createElement("div",{className:"modal"},o.a.createElement("div",{className:"modal-dialog",role:"document"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("header",{className:"modal-header"},o.a.createElement("h1",{className:"modal-title"},e.title),o.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:e.onCancel},o.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),o.a.createElement("section",{className:"modal-body"},e.children),o.a.createElement("section",{className:"modal-footer"},e.canCancel&&o.a.createElement("button",{className:"btn btn-secondary","data-dismiss":"modal",onClick:e.onCancel},"Cancel"),e.canConfirm&&o.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.onConfirm()}},"Confirm")))))}),b=(a(56),function(e){return o.a.createElement("div",{className:"backdrop"})}),N=(a(57),function(e){Object(s.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={creating:!1,codici:[]},n.startCreateHandler=function(){n.setState({creating:!0})},n.modalConfirmHandler=function(){n.setState({creating:!1});var e=n.entitascontoEl.current.value,t=n.messaggioEl.current.value,a=n.validitaEl.current.value;if(0!==e.trim().length&&0!==t.trim().length&&0!==a.trim().length){var o={query:'\n              mutation{\n                createCode(codeInput:{ entitasconto:"'.concat(e,'" , messaggio:"').concat(t,'" , validita:"').concat(a,'" }){\n                      _id\n                      code\n                      validita\n                      entitasconto\n                      messaggio\n                  }\n              }\n              ')},c=n.context.token;f.a.post("/graphql",o,{headers:{"Content-Type":"application/json",Authorization:"Bearer"+c}}).then((function(e){n.fetchCodici()})).catch((function(e){console.log(e,e.response)}))}},n.onCancelCode=function(e){console.log(e);var t={query:'\n          mutation{\n            cancelCode( codeId:"'.concat(e,'"){\n                  _id\n                 title\n                 email\n              }\n          }\n          ')},a=n.context.token;f.a.post("/graphql",t,{headers:{"Content-Type":"application/json",Authorization:"Bearer"+a}}).then((function(e){n.fetchCodici()})).catch((function(e){console.log(e,e.response)}))},n.modalCancelHandler=function(){n.setState({creating:!1})},n.entitascontoEl=o.a.createRef(),n.messaggioEl=o.a.createRef(),n.validitaEl=o.a.createRef(),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.fetchCodici()}},{key:"fetchCodici",value:function(){var e=this,t=this.context.token;f.a.post("/graphql",{query:"\n                query {\n                  codici {\n                    _id\n                    code\n                    entitasconto\n                    messaggio\n                    validita\n                    commerciante{\n                      email\n                      title\n                    }\n                    \n                   \n                  }\n                }\n              "},{headers:{"Content-Type":"application/json",Authorization:"Bearer"+t}}).then((function(t){var a=t.data.data.codici;e.setState({codici:a})})).catch((function(e){console.log(e,e.response)}))}},{key:"render",value:function(){var e=this,t=this.state.codici.map((function(t){var a="https://wa.me/?text="+encodeURI(t.messaggio);return o.a.createElement("li",{key:t._id,className:"card"},t.code," ",o.a.createElement("div",{className:"bottoni"}," ",o.a.createElement("a",{href:a},o.a.createElement("button",{className:"btn btn-primary"},"Condividi")),o.a.createElement("button",{className:"btn btn-primary",onClick:function(){e.onCancelCode(t._id)}},"Brucia Codice")))}));return o.a.createElement(o.a.Fragment,null,this.state.creating&&o.a.createElement(b,null),this.state.creating&&o.a.createElement(v,{title:"Add codici",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler},o.a.createElement("form",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"text",id:"entitascontoEl",ref:this.entitascontoEl,placeholder:"entita sconto"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"text",id:"messaggioEl",ref:this.messaggioEl,placeholder:"Messaggio"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"date",id:"validita",ref:this.validitaEl,placeholder:"Validita"})))),this.context.token&&o.a.createElement("div",{className:"container"},o.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.startCreateHandler},"Create codice")),o.a.createElement("div",{className:"accordion",id:"accordionExample"},o.a.createElement("ul",null,t)))}}]),a}(n.Component));N.contextType=E;var k=N,C=(a(58),function(e){return o.a.createElement(E.Consumer,null,(function(e){return o.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-primary",id:"main-navigation"},o.a.createElement("div",{className:"navbar-brand"}),o.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarColor01","aria-controls":"navbarColor01","aria-expanded":"false","aria-label":"Toggle navigation"},o.a.createElement("span",{className:"navbar-toggler-icon"})),o.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarColor01"},o.a.createElement("ul",{className:"navbar-nav mr-auto"},o.a.createElement("li",{className:"nav-item"},o.a.createElement(u.b,{className:"nav-link",to:"/"},"Home")),e.token&&o.a.createElement("li",{className:"nav-item"},o.a.createElement(u.b,{className:"nav-link",to:"/commerciante"},"Utente")))),o.a.createElement("div",{className:"authentication"},!e.token&&o.a.createElement("li",{className:"nav-item"},o.a.createElement(u.b,{to:"/login"},o.a.createElement("button",{className:"btn btn-primary"},"Login"))),e.token&&o.a.createElement("li",{className:"nav-item"},o.a.createElement("button",{className:"btn btn-primary",onClick:e.logout},"Logout"))))}))}),y=(a(64),function(e){Object(s.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).state={token:null,commId:null},e.refreshToken=function(){var e=localStorage.getItem("tokens");return console.log(e),null!==e?Promise.resolve(e):Promise.resolve(!1)},e.login=function(t,a,n){localStorage.setItem("tokens",t),e.setState({token:t,commId:a,tokenExpiration:n})},e.logout=function(){localStorage.removeItem("tokens"),e.setState({token:null,commId:null})},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.refreshToken().then((function(t){if(console.log(t),t){var a=t.split(".")[1].replace("-","+").replace("_","/"),n=JSON.parse(atob(a));e.setState({token:t,commId:n.commId})}}))}},{key:"render",value:function(){return o.a.createElement(u.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(E.Provider,{value:{token:this.state.token,commId:this.state.commId,login:this.login,logout:this.logout}},o.a.createElement(C,null),o.a.createElement("main",{className:"main-content"},o.a.createElement(d.d,null,!this.state.token&&o.a.createElement(d.a,{from:"/",to:"/login",exact:!0}),!this.state.token&&o.a.createElement(d.a,{from:"/commerciante",to:"/login",exact:!0}),this.state.token&&o.a.createElement(d.a,{from:"/",to:"/commerciante",exact:!0}),this.state.token&&o.a.createElement(d.a,{from:"/login",to:"/commerciante",exact:!0}),!this.state.token&&o.a.createElement(d.b,{path:"/login",component:h}),this.state.token&&o.a.createElement(d.b,{path:"/commerciante",component:k}))))))}}]),a}(n.Component));l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(y,null)),document.getElementById("root"))}},[[31,1,2]]]);
//# sourceMappingURL=main.e1e30588.chunk.js.map